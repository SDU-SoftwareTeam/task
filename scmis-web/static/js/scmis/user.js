var api=['username','name','department','major','class','role'];var addstandard=['username','name','password','department','major','role','class'];var dataTablesObject=null;$(document)['ready'](function(){dataTablesObject=initTable('table');$('#btn-Query')['on']('click',queryuser);$('#btn-upload')['on']('click',uploaduser);queryuser();});function queryuser(){let _0xa499ec=JSON['stringify']({'username':$('#userName')['val'](),'name':$('#Name')['val']()});AJAX({'url':'/api/user/query','type':'post','data':_0xa499ec,'contentType':'application/json','beforeSend':function(){NProgress['start']();},'complete':function(){NProgress['done']();},'success':function(_0x3fdde6){if(_0x3fdde6['errcode']!=='0'){alert(_0x3fdde6['errmsg']);if(_0x3fdde6['errcode']==='4101'){window['location']['href']='/';}return;}if(typeof dataTablesObject!=='undefined'&&dataTablesObject!==null){dataTablesObject['destroy']();}$('#table>tbody\x20tr')['remove']();let _0x2bb533=$('#table>tbody')[0x0];_0x3fdde6['data']['forEach'](function(_0x4d094d){let _0xbd8c3f=_0x2bb533['insertRow']();for(let _0x319b55=0x0;_0x319b55<api['length'];_0x319b55++){let _0x17de8f=_0xbd8c3f['insertCell']();_0x17de8f['style']='text-align:\x20center;';_0x17de8f['innerHTML']=_0x4d094d[api[_0x319b55]];_0x17de8f['setAttribute']('value',_0x17de8f['innerHTML']);if(api[_0x319b55]==='role'){if(_0x17de8f['innerHTML']==='0')_0x17de8f['innerHTML']='管理员';else if(_0x17de8f['innerHTML']==='1')_0x17de8f['innerHTML']='教师';else if(_0x17de8f['innerHTML']==='2')_0x17de8f['innerHTML']='学生';}}let _0x52ddf7=_0xbd8c3f['insertCell']();_0x52ddf7['style']='text-align:\x20center;';_0x52ddf7['innerHTML']='<a\x20style=\x27cursor:pointer\x27\x20onclick=\x27editinformationClicked(this)\x27>更改信息\x20&nbsp</a>\x20'+'<a\x20style=\x27cursor:pointer\x27\x20onclick=\x27editpasswordClicked(this)\x27>更改密码\x20&nbsp</a>'+'<a\x20style=\x27cursor:pointer\x27\x20onclick=\x27editauthorityClicked(this)\x27>更改权限\x20&nbsp</a>'+'<a\x20style=\x27cursor:pointer\x27\x20onclick=\x27deleteClicked(this)\x27>删除用户</a>';});dataTablesObject=initTable('table');}});}function deleteClicked(_0x3bdcc0){if(confirm('确认删除该用户？')){AJAX({'url':'/api/user/delete','type':'POST','data':JSON['stringify']({'username':_0x3bdcc0['parentElement']['parentElement']['cells'][0x0]['innerHTML']}),'contentType':'application/json','beforeSend':function(){NProgress['start']();},'complete':function(){NProgress['done']();},'success':function(_0x18566a){if(_0x18566a['errcode']==='0'){dataTablesObject['row'](_0x3bdcc0['parentElement']['parentElement'])['remove']()['draw']();alert(_0x18566a['errmsg']);}else{alert(_0x18566a['errmsg']);}}});}}function editpasswordClicked(_0x488742){_0x488742=_0x488742['parentElement']['parentElement']['cells'];for(var _0x2ab4b7=0x0;_0x2ab4b7<api['length'];_0x2ab4b7++){$('#input-edituser-'+api[_0x2ab4b7])['val'](_0x488742[_0x2ab4b7]['getAttribute']('value'));}$('#edituserInfoModal')['modal']();$('#input-edituser-role')['parent']()['hide']();$('#input-edituser-department')['parent']()['hide']();$('#input-edituser-major')['parent']()['hide']();$('#input-edituser-class')['parent']()['hide']();$('#input-edituser-name')['parent']()['show']();$('#input-edituser-newpassword')['show']();$('#btn-edituserConfirm')['on']('click',function(){let _0x34c77e=JSON['stringify']({'username':$('#input-edituser-username')['val'](),'password':$('#input-edituser-newpassword')['val']()});AJAX({'url':'/api/user/editPassword','type':'POST','data':_0x34c77e,'contentType':'application/json','beforeSend':function(){NProgress['start']();$('#btn-edituserConfirm')['text']('修改中...')['attr']('disabled',!![]);},'complete':function(){NProgress['done']();$('#btn-edituserConfirm')['text']('确认修改')['attr']('disabled',![]);},'success':function(_0x2bb243){if(_0x2bb243['errcode']==='0'){alert('修改成功！');location['reload']();}else{alert('修改失败~');}}});});}function editinformationClicked(_0x1b9efe){_0x1b9efe=_0x1b9efe['parentElement']['parentElement']['cells'];for(var _0x11643b=0x0;_0x11643b<api['length'];_0x11643b++){$('#input-edituser-'+api[_0x11643b])['val'](_0x1b9efe[_0x11643b]['getAttribute']('value'));}$('#edituserInfoModal')['modal']();$('#input-edituser-role')['parent']()['hide']();$('#input-edituser-department')['parent']()['show']();$('#input-edituser-major')['parent']()['show']();$('#input-edituser-class')['parent']()['show']();$('#input-edituser-name')['parent']()['show']();$('#btn-edituserConfirm')['on']('click',function(){let _0x20c01d=JSON['stringify']({'username':$('#input-edituser-username')['val'](),'name':$('#input-edituser-name')['val'](),'department':$('#input-edituser-department')['val'](),'major':$('#input-edituser-major')['val'](),'class':$('#input-edituser-class')['val']()});AJAX({'url':'/api/user/adminEdit','type':'POST','data':_0x20c01d,'contentType':'application/json','beforeSend':function(){NProgress['start']();$('#btn-edituserConfirm')['text']('修改中...')['attr']('disabled',!![]);},'complete':function(){NProgress['done']();$('#btn-edituserConfirm')['text']('确认修改')['attr']('disabled',![]);},'success':function(_0x588656){if(_0x588656['errcode']==='0'){alert('修改成功！');location['reload']();}else{alert('修改失败~');}}});});}function editauthorityClicked(_0x3766d4){_0x3766d4=_0x3766d4['parentElement']['parentElement']['cells'];for(var _0x524c50=0x0;_0x524c50<api['length'];_0x524c50++){$('#input-edituser-'+api[_0x524c50])['val'](_0x3766d4[_0x524c50]['getAttribute']('value'));}$('#edituserInfoModal')['modal']();$('#input-edituser-role')['parent']()['show']();$('#input-edituser-department')['parent']()['hide']();$('#input-edituser-major')['parent']()['hide']();$('#input-edituser-class')['parent']()['hide']();$('#input-edituser-name')['parent']()['hide']();$('#btn-edituserConfirm')['on']('click',function(){let _0x580491=JSON['stringify']({'username':$('#input-edituser-username')['val'](),'role':$('#input-edituser-role')['val']()});AJAX({'url':'/api/user/editRole','type':'POST','data':_0x580491,'contentType':'application/json','beforeSend':function(){NProgress['start']();$('#btn-edituserConfirm')['text']('修改中...')['attr']('disabled',!![]);},'complete':function(){NProgress['done']();$('#btn-edituserConfirm')['text']('确认修改')['attr']('disabled',![]);},'success':function(_0x28cb7c){if(_0x28cb7c['errcode']==='0'){alert('修改成功！');location['reload']();}else{alert('修改失败~');}}});});}function uploaduser(){$('#submitfileModal')['modal']();document['querySelector']('#userfile')['addEventListener']('change',function(){var _0x210ec3=document['querySelector']('#userfile')['files'][0x0];var _0x332945=_0x210ec3['name']['split']('.');if(_0x332945[_0x332945['length']-0x1]!=='xlsx'&&_0x332945[_0x332945['length']-0x1]!=='xls'){alert('只能选择excel文件导入');return![];}const _0x48384d=new FileReader();_0x48384d['readAsBinaryString'](_0x210ec3);_0x48384d['onload']=_0x338b47=>{const _0x4d8270=_0x338b47['target']['result'];const _0x304827=window['XLS']['read'](_0x4d8270,{'type':'binary'});var _0x533372=[];for(let _0x4313fa=0x0;_0x4313fa<_0x304827['SheetNames']['length'];_0x4313fa++){const _0x33f0ae=window['XLS']['utils']['sheet_to_json'](_0x304827['Sheets'][_0x304827['SheetNames'][_0x4313fa]]);_0x533372['push'](..._0x33f0ae);}for(let _0x33b2bc=0x0;_0x33b2bc<_0x533372['length'];_0x33b2bc++){var _0x635e5d=_0x533372[_0x33b2bc];if(_0x635e5d['role']==='管理员')_0x635e5d['role']='0';else if(_0x635e5d['role']==='教师')_0x635e5d['role']='1';else if(_0x635e5d['role']==='学生')_0x635e5d['role']='2';}$('#submitfile')['on']('click',function(){for(let _0x39340c=0x0;_0x39340c<_0x533372['length'];_0x39340c++){var _0x2a1bc7=_0x533372[_0x39340c];var _0x251cb4=-0x1;for(var _0x5cdadb in _0x2a1bc7){_0x251cb4++;if(_0x5cdadb!==addstandard[_0x251cb4]||_0x2a1bc7[_0x5cdadb]==''){alert('表格格式错误，请重新上传');return;};}if(_0x2a1bc7['role']!=='0'&&_0x2a1bc7['role']!=='1'&&_0x2a1bc7['role']!=='2'){alert('表格角色部分填写错误，请重新上传');return;}}AJAX({'url':'/api/user/add','type':'POST','data':JSON['stringify'](_0x533372),'contentType':'application/json','beforeSend':function(){NProgress['start']();},'complete':function(){NProgress['done']();},'success':function(_0x16c630){if(_0x16c630['errcode']==='0'){alert(_0x16c630['errmsg']);location['reload']();}else{alert(_0x16c630['errmsg']);}}});});};});}